# Лабораторная работа 6: Построение и визуализация трехмерных объектов

# 1 Общее описание

## 1.1 Основные возможности

Программа "3D Графика" представляет собой полнофункциональное приложение для работы с трехмерной графикой, включающее три этапа лабораторной работы:

**Часть 6a - Построение 3D объектов:**
- Создание каркасной модели трехмерного объекта (буква "A")
- Визуализация объекта в трехмерном пространстве
- Отображение системы координат и осей

**Часть 6b - 3D преобразования:**
- Масштабирование объекта по всем осям
- Перенос (трансляция) вдоль осей X, Y, Z
- Вращение вокруг произвольных осей (X, Y, Z)
- Автоматическое вращение
- Отображение итоговой матрицы преобразования 4×4

**Часть 6c - Построение проекций:**
- Перспективная проекция с настройкой угла обзора
- Ортографическая проекция
- Три ортографические проекции на координатные плоскости:
  - XY плоскость (вид сверху)
  - XZ плоскость (вид спереди)
  - YZ плоскость (вид сбоку)

## 1.2 Трехмерные модели и преобразования

### Каркасная модель
**Тип модели:** Wireframe (проволочная модель)  
**Объект:** Трехмерное изображение буквы "A"  
**Структура:**
- 16 вершин в трехмерном пространстве
- 32 ребра, соединяющих вершины
- Двойной контур для создания объема

**Математическое представление:**
```
V = {v₁, v₂, ..., v₁₆} где vᵢ = (xᵢ, yᵢ, zᵢ)
E = {(vᵢ, vⱼ)} - набор ребер
```

### Система координат
**Правосторонняя система:** X - вправо, Y - вверх, Z - на наблюдателя  
**Единицы измерения:** Условные единицы (1 единица = произвольный масштаб)

### Преобразования
**Матричная форма:** Все преобразования представлены матрицами 4×4:
```
[ a₁₁ a₁₂ a₁₃ tₓ ]
[ a₂₁ a₂₂ a₂₃ tᵧ ]
[ a₃₁ a₃₂ a₃₃ t_z ]
[  0   0   0   1  ]
```

# 2 Руководство пользователя

## 2.1 Запуск программы

Программа написана на Python с использованием PySide6 и NumPy, запускается командой:

```bash
python main.py
```

**Системные требования:**
- Python 3.7+
- PySide6
- NumPy

**Установка зависимостей:**
```bash
pip install PySide6 numpy
```

## 2.2 Интерфейс программы

**Главное окно разделено на две части:**

**1. Панель управления (левая часть, 300px):**
- Группа "Преобразования" - слайдеры для управления
- Группа "Проекции" - переключение режимов отображения
- Группа "Матрица преобразования" - отображение текущей матрицы 4×4
- Группа "Управление" - кнопки сброса и автоповорота

**2. Область визуализации (правая часть):**
- Черный фон (#14141E)
- Белые оси координат
- 3D модель буквы "A"
- Информация о текущих параметрах

## 2.3 Элементы управления

### Преобразования:
- **Вращение X/Y/Z:** Слайдеры от -180° до +180°
- **Масштаб:** Слайдер от 0.1× до 3.0×
- **Перенос X/Y/Z:** Слайдеры от -4.0 до +4.0

### Проекции:
- **Перспективная проекция:** Стандартный 3D вид с перспективой
- **Ортографическая проекция:** Параллельные проекции без перспективы
- **Показать 3 проекции:** Одновременный вид проекций на XY, XZ, YZ плоскости

### Управление:
- **Сброс преобразований:** Возврат к исходному состоянию
- **Вкл/Выкл автоповорот:** Автоматическое вращение вокруг оси Y

## 2.4 Работа с программой

**Базовые операции:**
1. **Изменение вращения:** Перемещайте слайдеры Rotation X/Y/Z
2. **Изменение масштаба:** Используйте слайдер Scale
3. **Перемещение объекта:** Используйте слайдеры Translate X/Y/Z
4. **Переключение проекций:** Выберите нужный тип проекции
5. **Просмотр трех проекций:** Включите опцию "Показать 3 проекции"

**Особенности работы:**
- Все изменения отображаются в реальном времени
- Матрица преобразования автоматически обновляется
- При включении автоповорота объект вращается вокруг оси Y
- В режиме трех проекций объект отображается одновременно в трех видах

**Визуальные подсказки:**
- 3D View: Белый текст с параметрами в левом верхнем углу
- Ортографические проекции: Подписи "XY Plane", "XZ Plane", "YZ Plane"
- Разделительные линии: Серые линии разделяют области проекций

# 3 Структура и архитектура приложения

## 3.1 Структура проекта

Программа построена по объектно-ориентированной архитектуре с четким разделением ответственности:

```
3DGraphicsApp/
├── main.py              # Главный файл с интерфейсом
├── ThreeDObject.py      # Класс 3D объекта
├── ThreeDWidget.py      # Виджет для визуализации
└── Transformations.py   # Математические преобразования
```

## 3.2 Взаимодействие компонентов

```
MainWindow (Интерфейс)
         ↑
         | События слайдеров и кнопок
         ↓
   ThreeDWidget (Визуализация)
         ↑
         | Преобразованные вершины
         ↓
    ThreeDObject (Модель)
         ↑
         | Матричные преобразования
         ↓
  MatrixOperations (Математика)
```

## 3.3 Анализ кода

**Основные классы:**

1. **ThreeDObject** - описание 3D модели:
```python
class ThreeDObject:
    def __init__(self):
        self.vertices = []  # Список вершин
        self.edges = []     # Список ребер
    
    def create_letter_a(self):
        # Создание каркасной модели буквы "A"
```

2. **ThreeDWidget** - визуализация и преобразования:
```python
class ThreeDWidget(QWidget):
    def __init__(self):
        # Инициализация 3D виджета
        self.transform_matrix = np.eye(4)
        self.projection_matrix = np.eye(4)
```

3. **MainWindow** - графический интерфейс:
```python
class MainWindow(QMainWindow):
    def __init__(self):
        # Создание интерфейса с панелями управления
```

**Ключевые алгоритмы:**

**Матричные преобразования:**
```python
def update_transform_matrix(self):
    # Композиция матриц: T * R * S
    self.transform_matrix = translation_matrix @ rotation_matrix @ scale_matrix
```

**Проекционные преобразования:**

1. **Перспективная проекция:**
```python
def update_projection_matrix(self):
    if self.projection_type == "perspective":
        fov = math.radians(45)
        f = 1.0 / math.tan(fov / 2)
        self.projection_matrix = np.array([
            [f/aspect, 0, 0, 0],
            [0, f, 0, 0],
            [0, 0, (far+near)/(near-far), (2*far*near)/(near-far)],
            [0, 0, -1, 0]
        ])
```

2. **Ортографическая проекция:**
```python
def project_point_orthographic(self, point, plane):
    # Проекция на конкретную плоскость
    if plane == "xy":
        x = (transformed[0] + 2) * self.width() / 4
        y = (2 - transformed[1]) * self.height() / 4
```

**Проекция точки:**
```python
def project_point(self, point):
    point_4d = np.array([point[0], point[1], point[2], 1])
    transformed = self.transform_matrix @ point_4d
    projected = self.projection_matrix @ transformed
    
    if projected[3] != 0:
        projected = projected / projected[3]
    
    # Преобразование в экранные координаты
    x = (projected[0] + 1) * self.width() / 2
    y = (1 - projected[1]) * self.height() / 2
```

## 3.4 Решенные проблемы

### Решенные проблемы:

**1. Создание каркасной 3D модели**
- *Проблема:* Представление объемной буквы в виде проволочной модели
- *Решение:* Определение 16 вершин и 32 ребер, образующих двойной контур буквы "A"

**2. Реализация матричных преобразований**
- *Проблема:* Корректное комбинирование преобразований
- *Решение:* Использование однородных координат и матриц 4×4, правильный порядок умножения матриц

**3. Проекции на координатные плоскости**
- *Проблема:* Одновременное отображение трех проекций
- *Решение:* Разделение области визуализации на 4 части и независимая проекция на каждую плоскость

**4. Интерактивное управление**
- *Проблема:* Плавное изменение параметров в реальном времени
- *Решение:* Использование слайдеров QSlider с мгновенным обновлением

**5. Автоматическое вращение**
- *Проблема:* Плавная анимация вращения
- *Решение:* Использование QTimer для периодического обновления угла вращения

**6. Отображение матрицы преобразования**
- *Проблема:* Читаемое представление матрицы 4×4
- *Решение:* Форматированный вывод с выравниванием и фиксированной шириной

### Нерешенные проблемы:

**1. Удаление невидимых линий**
- *Проблема:* Отсутствие алгоритмов удаления невидимых поверхностей
- *Текущее состояние:* Все линии отображаются всегда (wireframe-режим)

**2. Более сложные 3D модели**
- *Проблема:* Ограниченность одной предопределенной моделью
- *Текущее состояние:* Только буква "A", нет возможности загрузки других моделей

**3. Текстурирование и освещение**
- *Проблема:* Отсутствие реалистичной визуализации
- *Текущее состояние:* Только каркасное представление без заливки

**4. Сохранение и загрузка состояния**
- *Проблема:* Невозможность сохранить текущее состояние сцены
- *Текущее состояние:* Все изменения теряются при закрытии программы

# 4 Реализованные технологии

## 4.1 Используемые технологии

**Языки и библиотеки:**
- **Python 3.10+** - основной язык программирования
- **PySide6 (Qt для Python)** - графический интерфейс
- **NumPy** - матричные операции и линейная алгебра
- **Математика 3D графики** - матрицы преобразований и проекций

**Алгоритмы и методы:**
1. **Матричные преобразования:**
   - Масштабирование (Scaling)
   - Вращение (Rotation) вокруг осей X, Y, Z
   - Перенос (Translation)
   - Композиция преобразований

2. **Проекционные преобразования:**
   - Перспективная проекция (Perspective Projection)
   - Ортографическая проекция (Orthographic Projection)
   - Проекции на координатные плоскости

3. **Однородные координаты:**
   - Использование координат (x, y, z, w)
   - Нормализация при делении на w-компоненту

## 4.2 Математическая основа

**Матрица вращения вокруг оси X:**
```
Rx(θ) = [ 1     0       0    0 ]
        [ 0   cosθ   -sinθ   0 ]
        [ 0   sinθ    cosθ   0 ]
        [ 0     0       0    1 ]
```

**Матрица вращения вокруг оси Y:**
```
Ry(θ) = [ cosθ   0   sinθ   0 ]
        [  0     1    0     0 ]
        [ -sinθ  0   cosθ   0 ]
        [  0     0    0     1 ]
```

**Матрица вращения вокруг оси Z:**
```
Rz(θ) = [ cosθ  -sinθ   0    0 ]
        [ sinθ   cosθ   0    0 ]
        [  0      0     1    0 ]
        [  0      0     0    1 ]
```

**Матрица переноса:**
```
T(dx,dy,dz) = [ 1  0  0  dx ]
              [ 0  1  0  dy ]
              [ 0  0  1  dz ]
              [ 0  0  0  1  ]
```

**Матрица масштабирования:**
```
S(sx,sy,sz) = [ sx  0   0   0 ]
              [ 0   sy  0   0 ]
              [ 0   0   sz  0 ]
              [ 0   0   0   1 ]
```

## 4.3 Архитектурные решения

**1. Модульность:**
- Отдельные классы для модели, визуализации и интерфейса
- Четкое разделение ответственности
- Возможность расширения функциональности

**2. Производительность:**
- Использование NumPy для векторных операций
- Минимальные перерисовки при обновлении
- Оптимизированные матричные умножения

**3. Пользовательский опыт:**
- Интуитивно понятный интерфейс
- Плавная анимация и мгновенный отклик
- Информативные подсказки и отображение состояния

**4. Гибкость:**
- Поддержка различных типов проекций
- Настраиваемые параметры преобразований
- Возможность добавления новых функций

## 4.4 Особенности реализации

**Система координат:**
- Правосторонняя система (right-handed)
- Центр координат в центре области визуализации
- Автоматическое масштабирование под размер окна

**Обработка событий:**
- Слайдеры: мгновенное обновление при изменении
- Кнопки: обработка нажатий
- Таймер: периодическое обновление для анимации

**Визуализация:**
- Антиалиасинг для сглаживания линий
- Настраиваемая толщина линий
- Цветовая дифференциация элементов

# 5 Заключение

## 5.1 Достигнутые результаты

В ходе выполнения лабораторной работы была разработана комплексная программа для работы с трехмерной графикой, полностью соответствующая требованиям всех трех частей задания:

**Лабораторная работа 6a - Построение 3D объектов:**
-  Создана каркасная модель трехмерного объекта (буква "A")
-  Реализована визуализация в трехмерном пространстве
-  Отображена система координат и оси

**Лабораторная работа 6b - 3D преобразования:**
-  Реализованы все основные преобразования: масштабирование, перенос, вращение
-  Вращение вокруг произвольных осей X, Y, Z
-  Отображение итоговой матрицы преобразования 4×4
-  Добавлена функция автоматического вращения

**Лабораторная работа 6c - Построение проекций:**
-  Реализована перспективная проекция
-  Реализована ортографическая проекция
-  Построены три ортографические проекции на координатные плоскости
-  Возможность одновременного просмотра всех проекций

## 5.2 Технические достижения

1. **Матричная математика:** Корректная реализация всех матричных операций
2. **Проекционные преобразования:** Точное вычисление перспективных и ортографических проекций
3. **Интерактивность:** Плавное управление всеми параметрами в реальном времени
4. **Визуализация:** Четкое отображение трехмерной сцены с подсказками
5. **Архитектура:** Модульная структура, позволяющая легко расширять функциональность

## 5.3 Образовательная ценность

Программа демонстрирует ключевые концепции компьютерной графики:
- Представление трехмерных объектов
- Матричные преобразования в однородных координатах
- Различные типы проекций
- Интерактивное управление 3D сценой

## 5.4 Возможные улучшения

**Ближайшие улучшения:**
1. Добавление загрузки 3D моделей из файлов (OBJ, STL)
2. Реализация алгоритмов удаления невидимых линий
3. Добавление простого освещения и затенения
4. Возможность сохранения и загрузки состояния сцены

**Долгосрочные улучшения:**
1. Поддержка текстур и материалов
2. Более сложные алгоритмы визуализации (ray tracing)
3. Анимация по ключевым кадрам
4. Экспорт в различные форматы

## 5.5 Вывод

Разработанная программа успешно демонстрирует основные принципы трехмерной компьютерной графики и предоставляет удобный инструмент для изучения матричных преобразований и проекций. Приложение соответствует всем требованиям лабораторной работы и может использоваться как учебное пособие по компьютерной графике.

Программа обладает расширяемой архитектурой, что позволяет добавлять новые функции и алгоритмы, делая ее хорошей основой для дальнейшего развития в области трехмерной визуализации.